(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{475:function(t,a,r){"use strict";r.r(a);var e=r(2),s=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"项目名称"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目名称"}},[t._v("#")]),t._v(" 项目名称：")]),t._v(" "),a("p",[t._v("pika_port")]),t._v(" "),a("h2",{attrs:{id:"项目作者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目作者"}},[t._v("#")]),t._v(" 项目作者：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/alexstocks",target:"_blank",rel:"noopener noreferrer"}},[t._v("AlexStocks"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"适用版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#适用版本"}},[t._v("#")]),t._v(" 适用版本：")]),t._v(" "),a("p",[t._v("3.1 和 2.x")]),t._v(" "),a("h2",{attrs:{id:"项目地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目地址"}},[t._v("#")]),t._v(" 项目地址：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/ipixiu/pika-tools",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/ipixiu/pika-tools"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Axlgrep/pika-tools",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Axlgrep/pika-tools 长期维护地址需自行编译"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"二进制包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二进制包"}},[t._v("#")]),t._v(" 二进制包：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/ipixiu/pika-port-bin",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/ipixiu/pika-port-bin"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[t._v("#")]),t._v(" 功能：")]),t._v(" "),a("p",[t._v("将Pika中的数据在线迁移到Pika、Redis（支持全量、增量同步）")]),t._v(" "),a("h2",{attrs:{id:"开发背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发背景"}},[t._v("#")]),t._v(" 开发背景：")]),t._v(" "),a("p",[t._v("之前Pika项目官方提供的pika_to_redis工具仅支持离线将Pika的DB中的数据迁移到Pika、Redis, 且无法增量同步，该工具可以直接伪装为一个Pika的从库，将主库数据通过同步获取并转发给Pika、Redis，同时并支持增量同步")]),t._v(" "),a("h2",{attrs:{id:"实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现：")]),t._v(" "),a("h3",{attrs:{id:"trysync线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trysync线程"}},[t._v("#")]),t._v(" trysync线程")]),t._v(" "),a("ol",[a("li",[t._v("尝试与主库建立同步关系")]),t._v(" "),a("li",[t._v("如果需要全同步，则在接收到master的db之后，启动migrator和sender线程将db里面的数据发送给Pika、Redis")]),t._v(" "),a("li",[t._v("启动Slaveping线程定期给主库发送心跳，完成建立主从关系")])]),t._v(" "),a("h3",{attrs:{id:"binlog-receiver线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#binlog-receiver线程"}},[t._v("#")]),t._v(" binlog_receiver线程")]),t._v(" "),a("ol",[a("li",[t._v("接收主库发送过来的binlog并且将其解析成redis命令")]),t._v(" "),a("li",[t._v("将redis命令转发给Pika、Redis")])]),t._v(" "),a("h3",{attrs:{id:"migrator线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrator线程"}},[t._v("#")]),t._v(" migrator线程")]),t._v(" "),a("ol",[a("li",[t._v("扫描不同数据类型的分库")]),t._v(" "),a("li",[t._v("将key进行解析成响应数据Pika、redis指令")]),t._v(" "),a("li",[t._v("将解析好的redis指令加载到sender的发送buf中")])]),t._v(" "),a("h3",{attrs:{id:"sender线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sender线程"}},[t._v("#")]),t._v(" sender线程")]),t._v(" "),a("ol",[a("li",[t._v("从发送buf中读取数据，以非阻塞方式向Pika、redis发送数据")]),t._v(" "),a("li",[t._v("接收Pika、redis返回的结果并解析，如果出现错误则显示错误结果")])]),t._v(" "),a("h2",{attrs:{id:"使用帮助"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用帮助"}},[t._v("#")]),t._v(" 使用帮助：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Usage: \n       pika_port [-h] [-t local_ip -p local_port -i master_ip -o master_port\n                  -m forward_ip -n forward_port -x forward_thread_num -y forward_passwd]\n                  -f filenum -s offset -w password -r rsync_dump_path  -l log_path\n        -h     -- show this help\n        -t     -- local host ip(OPTIONAL default: 127.0.0.1)\n        -p     -- local port(OPTIONAL)\n        -i     -- master ip(OPTIONAL default: 127.0.0.1)\n        -o     -- master port(REQUIRED)\n        -m     -- forward ip(OPTIONAL default: 127.0.0.1)\n        -n     -- forward port(REQUIRED)\n        -x     -- forward thread num(OPTIONAL default: 1)\n        -y     -- forward password(OPTIONAL)\n        -f     -- binlog filenum(OPTIONAL default: local offset)\n        -s     -- binlog offset(OPTIONAL default: local offset)\n        -w     -- password for master(OPTIONAL)\n        -r     -- rsync dump data path(OPTIONAL default: ./rsync_dump)\n        -l     -- local log path(OPTIONAL default: ./log)\n        -b     -- max batch number when port rsync dump data (OPTIONAL default: 512)\n        -d     -- daemonize(OPTIONAL)\n  example: ./pika_port -t 127.0.0.1 -p 12345 -i 127.0.0.1 -o 9221 -m 127.0.0.1 -n 6379 -x 7 -f 0 -s 0 -w abc -l ./log\n")])])])])}),[],!1,null,null,null);a.default=s.exports}}]);